<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="android,单元测试," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="阅读本文大约需要8分钟">
<meta property="og:type" content="article">
<meta property="og:title" content="Android单元测试——辅助工具介绍">
<meta property="og:url" content="http://yoursite.com/2016/05/08/Android单元测试——辅助工具介绍/index.html">
<meta property="og:site_name" content="You's blog">
<meta property="og:description" content="阅读本文大约需要8分钟">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/Android单元测试.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/1Gradle面板方式运行.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/2Terminal控制台方式运行.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/3androidTest测试报告.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/4androidTest覆盖率报告.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/5jacocoTask.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/6test报告.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/7覆盖率报告.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/8控制台运行方式.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/9test控制台运行结果.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/11findBugs安装.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/12findBugs代码检测.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/13findBugs筛选、.png">
<meta property="og:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/14运行结果.png">
<meta property="og:updated_time" content="2016-10-28T13:19:57.739Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android单元测试——辅助工具介绍">
<meta name="twitter:description" content="阅读本文大约需要8分钟">
<meta name="twitter:image" content="http://yoursite.com/imgs/Android单元测试——辅助工具介绍/Android单元测试.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/05/08/Android单元测试——辅助工具介绍/"/>

  <title> Android单元测试——辅助工具介绍 | You's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">You's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android单元测试——辅助工具介绍
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-08T21:30:31+08:00" content="2016-05-08">
              2016-05-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/白盒测试/" itemprop="url" rel="index">
                    <span itemprop="name">白盒测试</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/imgs/Android单元测试——辅助工具介绍/Android单元测试.png" alt="Android单元测试">    </p>
<blockquote class="blockquote-center">阅读本文大约需要8分钟</blockquote>

<a id="more"></a>
<font size="5"><strong>目录</strong></font>

<hr>
<p><a href="#jump1"><strong>一.Code Coverage Tool : jacoco、IntelliJ IDEA</strong></a></p>
<p><a href="#jump2"><strong>二.静态代码检测工具：FindBugs</strong></a></p>
<p><a href="#jump3"><strong>三.Annotation、@Rule介绍</strong></a></p>
<hr>
<p>最近在学习单元测试的相关知识，在这里我将分享一下我在学习过程中，使用到的一些辅助工具或框架。我也是一个初学小白，不足之处，还望大家予以指正。</p>
<p>文中使用的IDE是Android Studio，下面涉及到的插件、工具或导包，都是以Android Studio为例。</p>
<font color="#EE6AA7"><strong>鸣谢：1.本文采用的代码来自<a href="https://github.com/geniusmart/LoveUT" target="_blank" rel="external">Robolectric3.0的介绍和实战</a>，该文附带的两篇博客也在单元测试方面给了我很大帮助，强烈推荐。</strong></font>



<font color="#EE6AA7"><strong>2.一些点子来自<a href="http://chriszou.com/2016/04/25/android-unit-testing-wechat-group-share.html#rd?sukey=fa67fe3435f5c4beb9df864eb76da9c7c53e64c529e8216896471e04e9f5e1659bc497b62a02125156d9025ab5a0207b" target="_blank" rel="external">Android单元测试在蘑菇街支付金融部门的实践</a>，该作者<a href="http://chriszou.com/" target="_blank" rel="external">小创</a> 有很多关于单元测试的知识值得学习。</strong></font>

<h2 id="一-Code-Coverage-Tool-（代码覆盖率工具）"><a href="#一-Code-Coverage-Tool-（代码覆盖率工具）" class="headerlink" title="一.Code Coverage Tool （代码覆盖率工具）:"></a><span id="jump1"><font size="3" color="#1C86EE"><strong>一.Code Coverage Tool （代码覆盖率工具）:</strong></font></span></h2><p>众所周知，在编写单元测试案例的过程中，有一个重要的指标就是代码覆盖率。编写单元测试并不是为了追求100%覆盖率，但覆盖率在单元测试中仍占据着不可或缺的地位。</p>
<p>经典的Java Coverage Tool : Emma、Eclemma（Eclipse推荐使用）、Cobertura，感兴趣的学者可以自行查阅资料。</p>
<p>接下来，我们来看Android Studio支持的Coverage Tool ： jacoco、IntelliJ IDEA。</p>
<p>在Android Stuido新建过工程的同学，应该有注意到，该工程默认会新建androidTest及test的测试包。在Android Stuido中，在androidTest编写的单元测试，默认使用jacoco插件生成包含代码覆盖率的测试报告；而test包下的单元测试代码，则直接使用Android Studio已有工具IntelliJ IDEA生成覆盖率，也可以通过自定义gradle task使用jacoco插件生成与androidTest相同格式的测试报告。</p>
<hr>
<font color="#EE6AA7"><strong>androidTest 与 test：</strong></font>

<p><strong>区别：</strong>androidTest是存放一些与View(UI界面层)相关的单元测试案例的测试代码集，需要在真机或虚拟机上运行。一般使用的框架有：Instrumentation、Espresso，也可以编写自动化测试案例（框架：Uiautomator2.0）；<br>而test包则一般只存放与Model(数据层)相关的单元测试案例，但Android几乎无法实现MV完全解耦，所以目前在test包下可能也会涉及到View的测试。直接在JVM虚拟机上运行即可，速度快。框架：Robolectric+Mockito+其他。</p>
<p><strong>运行方式：</strong>Android Studio 2.0版本开始，已经能够智能检测当前的测试是androidTest还是test了，低版本的可以在Build Variants中设置Test Artifact或者Add New Configuration 时选择Unit Tests(对应test),Android Instrumentation Tests(对应androidTest)。</p>
<hr>
<h3 id="jacoco"><a href="#jacoco" class="headerlink" title="jacoco:"></a><strong>jacoco:</strong></h3><ul>
<li><strong>先讲androidTest的使用方法</strong></li>
</ul>
<p>在Module gradle文件中添加以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apply plugin : &apos;com.android.application&apos;</span><br><span class="line">apply plugin: &apos;jacoco&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled false</span><br><span class="line">        proguardFiles getDefaultProguardFile (&apos;proguard-android.txt&apos; ), &apos;proguard-rules.pro&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    debug &#123;</span><br><span class="line">        testCoverageEnabled true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加完代码之后，打开右侧的Gradle面板运行connectedAndroidTest任务，<br>或在Terminal控制台输入 gradlew connectedAndroidTest，回车</p>
<p><img src="/imgs/Android单元测试——辅助工具介绍/1Gradle面板方式运行.png" alt="Gradle面板方式运行">    </p>
<p><img src="/imgs/Android单元测试——辅助工具介绍/2Terminal控制台方式运行.png" alt="Terminal控制台方式运行"></p>
<p>在\app\build\reports\androidTests\connected\index.html：<br><img src="/imgs/Android单元测试——辅助工具介绍/3androidTest测试报告.png" alt="androidTest测试报告"></p>
<p>在\app\build\reports\coverage\debug \index.html：<br><img src="/imgs/Android单元测试——辅助工具介绍/4androidTest覆盖率报告.png" alt="androidTest覆盖率报告"></p>
<p>androidTest包下未添加测试案例，所以Test Summary测试条数为0，覆盖率也都为0。可自行添加案例测试</p>
<ul>
<li><strong>对于test包下，如果使用jacoco生成覆盖率将会麻烦一点点</strong></li>
</ul>
<p>需要在gradle中自定义task,代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">task jacocoTestReport( type : JacocoReport, dependsOn : &quot;testDebugUnitTest&quot;) &#123;</span><br><span class="line">    group = &quot;Reporting&quot;</span><br><span class="line"></span><br><span class="line">    description = &quot;Generate Jacoco coverage reports&quot;</span><br><span class="line"></span><br><span class="line">    // exclude auto-generated classes and tests</span><br><span class="line">    def fileFilter = [ &apos;**/R.class&apos;, &apos;**/R$*.class&apos; ,</span><br><span class="line">                      &apos;**/BuildConfig.*&apos; , &apos;**/Manifest*.*&apos; ,</span><br><span class="line">                      &apos;android/**/*.*&apos; ]</span><br><span class="line">    def debugTree = fileTree( dir:</span><br><span class="line">            &quot; $&#123; project. buildDir &#125;/intermediates/classes/debug&quot; ,</span><br><span class="line">            excludes : fileFilter)</span><br><span class="line">    def mainSrc = &quot;$&#123; project .projectDir &#125;/src/main/java&quot;</span><br><span class="line"></span><br><span class="line">    sourceDirectories = files([mainSrc])</span><br><span class="line">    classDirectories = files([debugTree])</span><br><span class="line">    additionalSourceDirs = files([</span><br><span class="line">            &quot; $&#123; buildDir&#125;/generated/source/buildConfig/debug&quot; ,</span><br><span class="line">            &quot; $&#123; buildDir&#125;/generated/source/r/debug&quot;</span><br><span class="line">    ])</span><br><span class="line">    executionData = fileTree( dir: project .projectDir , includes:</span><br><span class="line">            [&apos;**/*.exec&apos; , &apos;**/*.ec&apos;])</span><br><span class="line"></span><br><span class="line">    reports &#123;</span><br><span class="line">        xml . enabled = true</span><br><span class="line">        xml . destination = &quot; $&#123;buildDir &#125;/jacocoTestReport.xml&quot;</span><br><span class="line">        csv . enabled = false</span><br><span class="line">        html . enabled = true</span><br><span class="line">        html . destination = &quot; $&#123;buildDir &#125;/reports/jacoco&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>添加task之后在右侧gradle面板中会发现，多了jacocoTestReport任务：<br><img src="/imgs/Android单元测试——辅助工具介绍/5jacocoTask.png" alt="jacocoTask"></p>
<p>在\app\build\reports\tests\debug\index.html：<br><img src="/imgs/Android单元测试——辅助工具介绍/6test报告.png" alt="test报告"></p>
<p>在\app\build\reports\jacoco\index.html：<br><img src="/imgs/Android单元测试——辅助工具介绍/7覆盖率报告.png" alt="test覆盖率报告"></p>
<font color="#EE6AA7"><strong>那么问题来了：<font color="#1C86EE">如果同时编写了androidTest与test单元测试代码，能否使用jacoco生成一份综合的代码覆盖率测试报告呢？</font>此处应有思考。</strong></font>

<h3 id="IntelliJ-IDEA："><a href="#IntelliJ-IDEA：" class="headerlink" title="IntelliJ IDEA："></a><strong>IntelliJ IDEA：</strong></h3><p>目前，只有test才支持此方式，操作步骤请看下图:<br><img src="/imgs/Android单元测试——辅助工具介绍/8控制台运行方式.png" alt="test控制台运行方式"><br>Tracing模式会增加消耗,但测量会更精确，但一般使用Sampling就足够。</p>
<p>生成报告：<br><img src="/imgs/Android单元测试——辅助工具介绍/9test控制台运行结果.png" alt="test控制台运行结果"></p>
<hr>
<font color="#EE6AA7"><strong>jacoco 与 IntelliJ IDEA:</strong></font>

<p>两者各有优缺点，最明显的不同是，jacoco生成的是html报告，如果使用Jenkins自动构建测试，应该使用jacoco；而 IntelliJ IDEA,其实也是采用jacoco检测覆盖率的，但其在面板中显示，较为直观，推荐在编写调试案例时使用。分不同情况使用不同的覆盖率工具，两者可以相互取长补短。</p>
<hr>
<h2 id="二-静态代码检测工具：FindBugs"><a href="#二-静态代码检测工具：FindBugs" class="headerlink" title="二.静态代码检测工具：FindBugs"></a><span id="jump2"><font size="3" color="#1C86EE"><strong>二.静态代码检测工具：FindBugs</strong></font></span></h2><p> <strong>what：</strong>静态代码分析是指无需运行被测代码，仅通过分析或检查源程序的语法、结构、过程、接口等来检查程序的正确性，找出代码隐藏的错误和缺陷，如参数不匹配，有歧义的嵌套语句，错误的递归，非法计算，可能出现的空指针引用等等。</p>
<p><strong>安装</strong>：AndroidStudio-&gt;Settigns-&gt;Plugins-&gt;Browse repositories-&gt;search “findBUgs-IDEA” 安装重启AndroidStudio即可。<br><img src="/imgs/Android单元测试——辅助工具介绍/11findBugs安装.png" alt="findBugs安装"></p>
<p>安装完之后，工程右键选择&gt;FindBugs&gt;Analyze Module Files，即可开始检测代码。<br><img src="/imgs/Android单元测试——辅助工具介绍/12findBugs代码检测.png" alt="findBugs代码检测"></p>
<p>若部分错误不想扫描，可右键工程-&gt;Open Module Settings里设置：<br><img src="/imgs/Android单元测试——辅助工具介绍/13findBugs筛选、.png" alt="findBugs筛选"></p>
<p><strong>扫描结果分析：</strong><br>该工程扫描出两种类型的错误Bad practice（坏的实践：不建议的写法，建议修改为约定俗成的写法）和Dodgy Code(危险代码： 具有潜在危险的代码，可能运行期产生错误)，并给出了详细的说明。此工程的代码量较少，且编码风格也较好，所以查出来的bug较少，FindBugs关于FindBugs更多信息，可查看<a href="http://www.myexception.cn/database/1920915.html" target="_blank" rel="external"><strong>一些你不知道的事，findbugs的配置跟使用</strong></a>。</p>
<p><font color="#EE6AA7"><strong>需要注意的是，</strong></font>虽然FindBugs能够对代码进行静态检测，但并不是FindBugs查找出来的bug就一定存在问题，也并不是所有潜在的bug，FidBugs都能查找出来，还需要开发者结合具体代码进行判断。</p>
<p><a href="http://qa.blog.163.com/blog/static/190147002201342382422899/" target="_blank" rel="external"><strong>为啥不用静态代码检查工具呢?</strong></a> 静态代码检查从入门到放弃。</p>
<h2 id="三-Annotation、-Rule介绍"><a href="#三-Annotation、-Rule介绍" class="headerlink" title="三.Annotation、@Rule介绍"></a><span id="jump3"><font size="3" color="#1C86EE"><strong>三.Annotation、@Rule介绍</strong></font></span></h2><p>Annotation 与 <a href="https://github.com/junit-team/junit4/wiki/Rules" target="_blank" rel="external"><strong>JUnit Rule</strong></a> 的详细使用，需要自行学习，这里只介绍<a href="http://chriszou.com/2016/04/25/android-unit-testing-wechat-group-share.html#rd?sukey=fa67fe3435f5c4beb9df864eb76da9c7c53e64c529e8216896471e04e9f5e1659bc497b62a02125156d9025ab5a0207b" target="_blank" rel="external"><strong>Android单元测试在蘑菇街支付金融部门的实践</strong></a>中提到的结合两者来编写测试方法的注释，来规避测试方法名冗长、难以定义、格式不美观的问题。当测试失败时，会在控制台上添加自定义的错误信息。这的确是一个不错的方法。</p>
<p>1).新建Annotation类，需要注意的是，单元测试以JUnit形式运行，需要添加@Retention，否则运行时无法检测到该类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Retention (RetentionPolicy. RUNTIME)</span><br><span class="line">public @interface Purpose &#123;</span><br><span class="line">    String desc () default &quot;&quot; ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2).新建实现MethodRule接口的自定义Rule类，在apply方法中处理案例执行前、执行成功或失败所做的操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class ErrorRule implements MethodRule &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Statement apply( final Statement base, final FrameworkMethod method , Object target) &#123;</span><br><span class="line">        return new Statement() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void evaluate () throws Throwable &#123;</span><br><span class="line">                /***starting(method);***/</span><br><span class="line">                ShadowLog. stream = System. out ;//此处是使用Robolectric框架的方法，将该测试案例的log输出到控制台，方便查看log</span><br><span class="line">                try &#123;</span><br><span class="line">                    base.evaluate() ;</span><br><span class="line">                    /***succeeded(method);***/</span><br><span class="line">                &#125; catch (Throwable t) &#123;</span><br><span class="line">                    /***failed(t, method);***/</span><br><span class="line">                    try &#123;</span><br><span class="line">                        System. err .print(&quot;@&quot; + method.getName() + &quot;---&gt;&quot; + method .getAnnotation(Purpose . class).desc()) ;</span><br><span class="line">                    &#125; catch (NullPointerException e) &#123;</span><br><span class="line"></span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line"></span><br><span class="line">                        throw t;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    /***finished(method);***/</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3).在测试类中调用Purpose、ErrorRule</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@RunWith (RobolectricGradleTestRunner. class)</span><br><span class="line">@Config (constants = BuildConfig. class)</span><br><span class="line">public class MainActivityTest &#123;</span><br><span class="line"></span><br><span class="line">    @Rule</span><br><span class="line">    public ErrorRule rule = new ErrorRule();</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    @Purpose( desc = &quot;when onCreate, the menu shoule be &apos;First menu item&apos; and &apos;Second menu item&apos;. &quot;)</span><br><span class="line">    public void onCreateShouldInflateTheMenu () &#123;</span><br><span class="line">        Activity activity = Robolectric. setupActivity(MainActivity. class) ;</span><br><span class="line"></span><br><span class="line">        final Menu menu = shadowOf(activity).getOptionsMenu() ;</span><br><span class="line">        assertEquals(menu.findItem(R.id. item1).getTitle() , &quot;first menu item&quot;) ;</span><br><span class="line">        assertEquals(menu.findItem(R.id. item2).getTitle() , &quot;Second menu item&quot;) ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4).运行结果：<br><img src="/imgs/Android单元测试——辅助工具介绍/14运行结果.png" alt="运行结果"></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/android/" rel="tag">#android</a>
          
            <a href="/tags/单元测试/" rel="tag">#单元测试</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/03/程序媛妹妹的编程之路/" rel="next" title="程序媛妹妹的编程之路">
                <i class="fa fa-chevron-left"></i> 程序媛妹妹的编程之路
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/09/03/Android客户端如何规避服务端数据格式错误导致的crash问题/" rel="prev" title="Android客户端如何规避服务端数据格式错误导致的crash问题">
                Android客户端如何规避服务端数据格式错误导致的crash问题 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="yoyo_zyx" />
          <p class="site-author-name" itemprop="name">yoyo_zyx</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一-Code-Coverage-Tool-（代码覆盖率工具）"><span class="nav-number">1.</span> <span class="nav-text">一.Code Coverage Tool （代码覆盖率工具）:</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#jacoco"><span class="nav-number">1.1.</span> <span class="nav-text">jacoco:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IntelliJ-IDEA："><span class="nav-number">1.2.</span> <span class="nav-text">IntelliJ IDEA：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二-静态代码检测工具：FindBugs"><span class="nav-number">2.</span> <span class="nav-text">二.静态代码检测工具：FindBugs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三-Annotation、-Rule介绍"><span class="nav-number">3.</span> <span class="nav-text">三.Annotation、@Rule介绍</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yoyo_zyx</span>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
